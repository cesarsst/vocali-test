import{g as b,r as f,p as U,c as h,o as _,a as e,t as v,q as C,s as S,k as j,v as N,x as R,l as E,y as P,z as w,F,A as M,b as g,B as D}from"./D6MxqhPJ.js";import{u as k,g as L,c as B,a as z,b as W}from"./BV_954AB.js";import A from"./BDdrdBD1.js";const O={class:"card z-depth-3 h-100"},V={class:"card-content"},q={class:"grey-text text-darken-1"},I={class:"row"},J={class:"col s6"},K=["disabled"],Y={class:"col s6"},G=["disabled"],H={class:"section"},Q={class:"grey-text text-darken-1"},X={class:"section"},Z={class:"black-text",style:{"white-space":"pre-wrap"}},ee=b({__name:"RealtimeTranscriptionCard",setup(u){const r=f(""),t=f(""),n=f(null),o=f(!1),c=f("Disconnected");let i=null;function m(){n.value=new WebSocket("ws://localhost:8080"),n.value.onmessage=l=>{const a=JSON.parse(l.data);a.type==="partial"?t.value=a.text:a.type==="final"?(r.value=a.text,t.value=""):a.type==="end"?s():a.type==="error"&&(alert("Error: "+a.message),s())},n.value.onclose=()=>{o.value=!1}}function d(){if(!n.value||n.value.readyState!==WebSocket.OPEN)try{m(),c.value="Connected"}catch(l){console.error("Error connecting to WebSocket:",l);return}setTimeout(()=>{navigator.mediaDevices.getUserMedia({audio:!0}).then(l=>{i=new MediaRecorder(l,{mimeType:"audio/webm;codecs=opus"}),i.ondataavailable=a=>{var p;a.data.size>0&&((p=n.value)==null?void 0:p.readyState)===WebSocket.OPEN&&a.data.arrayBuffer().then($=>{var T;(T=n.value)==null||T.send($)})},i.start(250),o.value=!0})},3e3)}function s(){var l;i==null||i.stop(),i=null,(l=n.value)==null||l.close(),n.value=null,o.value=!1,c.value="Disconnected"}return U(()=>{s()}),(l,a)=>(_(),h("div",O,[e("div",V,[a[2]||(a[2]=e("span",{class:"card-title"},"Real Time Transcription",-1)),e("p",q,"WebSocket state: "+v(c.value),1),e("div",I,[e("div",J,[e("button",{class:"btn green waves-effect waves-light",onClick:d,disabled:o.value}," Start Recording ",8,K)]),e("div",Y,[e("button",{class:"btn red waves-effect waves-light",onClick:s,disabled:!o.value}," Stop Recording ",8,G)])]),e("div",H,[a[0]||(a[0]=e("h6",{class:"blue-text text-darken-2"},"Partial:",-1)),e("p",Q,[e("i",null,v(t.value),1)])]),e("div",X,[a[1]||(a[1]=e("h6",{class:"blue-text text-darken-2"},"Final:",-1)),e("p",Z,v(r.value),1)])])]))}}),x=C("transcription",{state:()=>({loading:!1,error:null,success:!1,transcriptions:[]}),actions:{async create(u,r){this.loading=!0,this.error=null,this.success=!1;try{const n=k().getToken;if(!n)throw new Error("Usuário não autenticado.");const o=await B(n,{transcription_name:u,file_key:r});if(!o.success)throw new Error(o.error||"Erro ao criar transcrição.");this.success=!0}catch(t){throw console.error("Erro ao criar transcrição:",t),this.error=t.message||"Erro desconhecido.",t}finally{this.loading=!1,this.fetchTranscriptions()}},async fetchTranscriptions(){try{const r=k().getToken;if(!r)throw new Error("Usuário não autenticado.");const t=await L(r);if(!t.success)throw new Error(t.error||"Erro ao obter transcrições.");if(!t.data||!t.data.transcriptions){this.transcriptions=[];return}return this.transcriptions=t.data.transcriptions,t.data}catch(u){throw console.error("Erro ao obter transcrições:",u),u}}}}),te=C("upload",{state:()=>({loading:!1,error:null,success:!1}),actions:{async uploadFiles(u,r){this.loading=!0,this.error=null,this.success=!1;try{const t=k(),n=x(),o=t.getToken;if(!o)throw new Error("User not authenticated.");for(const c of Array.from(r)){const i=await z(o,{fileName:c.name,fileType:c.type});if(!i.success||!i.data)throw new Error(i.error||"Error obtaining upload URL.");await W(i.data.uploadUrl,c),await n.create(u,i.data.fileKey)}this.success=!0}catch(t){throw console.error("Error uploading files:",t),this.error=t.message||"Unknown error.",t}finally{this.loading=!1}}}}),se={class:"card z-depth-3 h-100"},ae={class:"card-content"},oe={class:"input-field"},ne={class:"file-field input-field"},re={class:"btn blue"},le={class:"section center-align"},ie={key:0,class:"red-text text-darken-2"},ce={key:1,class:"green-text text-darken-2"},de={class:"card-action center-align"},ue=["disabled"],pe=b({__name:"ProjectUploadCard",props:{projectName:{},projectNameModifiers:{},selectedFiles:{},selectedFilesModifiers:{}},emits:["update:projectName","update:selectedFiles"],setup(u){const r=S(u,"projectName"),t=S(u,"selectedFiles"),n=f(""),o=f(""),c=f(!1),i=async()=>{var s;const d=te();if(n.value="",o.value="",c.value=!0,!r.value||!((s=t.value)!=null&&s.length)){n.value="Please fill in the project name and select audio files.",c.value=!1;return}try{await d.uploadFiles(r.value,t.value),o.value="Project uploaded successfully!",setTimeout(()=>{m()},3e3)}catch(l){console.error("Error uploading project:",l),n.value="Error uploading the project."}finally{c.value=!1}},m=()=>{r.value="",t.value=null,n.value="",o.value=""};return(d,s)=>(_(),h("div",se,[e("div",ae,[s[4]||(s[4]=e("span",{class:"card-title black-text"}," New Transcription",-1)),e("div",oe,[j(e("input",{id:"project-name",type:"text","onUpdate:modelValue":s[0]||(s[0]=l=>r.value=l),required:""},null,512),[[N,r.value]]),e("label",{for:"project-name",class:R({active:r.value})}," Transcription Name ",2)]),e("div",ne,[e("div",re,[s[2]||(s[2]=e("span",null,"Select Audio",-1)),e("input",{type:"file",accept:"audio/*",multiple:"",onChange:s[1]||(s[1]=l=>t.value=l.target.files)},null,32)]),s[3]||(s[3]=e("div",{class:"file-path-wrapper"},[e("input",{class:"file-path validate",type:"text",placeholder:"Select audio files"})],-1))]),e("div",le,[n.value?(_(),h("p",ie,v(n.value),1)):E("",!0),o.value?(_(),h("p",ce,v(o.value),1)):E("",!0)])]),e("div",de,[e("button",{class:"btn-large green waves-effect waves-light",disabled:c.value,onClick:i},v(c.value?"Uploading transcription...":"Transcribe"),9,ue)])]))}}),ve={class:"card z-depth-3"},fe={class:"card-content"},he={class:"collection"},_e={style:{display:"flex","flex-direction":"column"}},me=["onClick"],ge={class:"card-action center-align"},be=["disabled"],we=["disabled"],y=10,ye=b({__name:"ProjectListCard",setup(u){const r=x(),{transcriptions:t}=P(r),n=w(()=>t.value.map(d=>({name:d.transcription_name,date:new Date(d.createdAt).toLocaleDateString(),text:d.text}))),o=f(1),c=w(()=>Math.ceil(n.value.length/y)),i=w(()=>{const d=(o.value-1)*y;return n.value.slice(d,d+y)});function m(d,s){const l=new Blob([s],{type:"text/plain"}),a=URL.createObjectURL(l),p=document.createElement("a");p.href=a,p.download=`${d}.txt`,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(a)}return(d,s)=>{const l=A;return _(),h("div",ve,[e("div",fe,[s[2]||(s[2]=e("span",{class:"card-title"}," Your Transcriptions ",-1)),e("ul",he,[(_(!0),h(F,null,M(i.value,(a,p)=>(_(),h("li",{key:p,class:"collection-item"},[e("div",_e,[e("strong",null,v(a.name),1),e("small",null,v(a.date),1),e("button",{class:"btn blue",onClick:$=>m(a.name,a.text||""),style:{"margin-top":"5px"}}," Download .txt ",8,me)])]))),128))])]),e("div",ge,[e("button",{class:"btn-flat",disabled:o.value===1,onClick:s[0]||(s[0]=a=>o.value--)},[g(l,{name:"mdi:chevron-left"})],8,be),e("span",null,"Page "+v(o.value)+" of "+v(c.value),1),e("button",{class:"btn-flat",disabled:o.value===c.value,onClick:s[1]||(s[1]=a=>o.value++)},[g(l,{name:"mdi:chevron-right"})],8,we)])])}}}),ke={class:"section"},xe={class:"row"},$e={class:"col s12 m10 l6 xl4 offset-m1"},Te={class:"col s12 m10 l6 xl4 offset-m1"},Se={class:"col s12 m10 l6 xl4 offset-m1"},je=b({__name:"dashboard",setup(u){const{fetchTranscriptions:r}=x();return D(async()=>{await r()}),(t,n)=>{const o=ee;return _(),h("section",ke,[e("div",xe,[e("div",$e,[g(pe)]),e("div",Te,[g(o)]),e("div",Se,[g(ye)])])])}}});export{je as default};
